总体思路: **多类型客户端** + **服务端** 的方式。客户端分为 worker 和 helper。

用例和具体功能如下。

##### 用例

worker向服务端发送注册请求，注册完成后，worker将屏幕截图数据发送给服务端，表示需要广播该截图，服务端收到后将截图发给所有helper。helper在完成注册后，将数据发送给服务端，表示广播该数据。服务端就将helper的数据发送给所有的worker，worker在收到服务端数据后自动将其添加到系统剪贴板中。

##### 功能描述

- 服务端
  - 维持心跳连接
  - 接收客户端注册请求
  - 将helper的数据发送给所有worker
  - 将worker的数据发送给所有helper
- worker客户端
  - 获取屏幕截图并发送给服务端
  - 获取服务端发送的数据并自动加入剪贴板
- helper客户端
  - 将用户设置的数据发送给服务端
  - 获取服务端发送的截图数据并自动保存打开

##### 实现

- 服务端
  - 流程
    ```
    创建套接字启动监听
    处理连接 - 子线程循环
      while true:
        发送心跳包
        读取数据 - 阻塞 1ms
          有数据
            1. 注册类型 - 确定类型，更新对应变量 workerNum, helperNum
            2. worker的截图数据 - 获取数据，设置refCnt=helperNum，添加到helper的消息队列
            3. helper的代码数据 - 获取数据，设置refCnt=workerNum，添加到worker的消息队列
        从消息队列取消息 - 阻塞 1ms
          将消息发送到对端
    ```
  - 数据结构
    ```
    消息队列 - workerMsgQueue, helperMsgQueue
    同步 - 互斥量，条件变量
    ```
- 客户端 helper
  - 流程
    ```
    建立连接
    注册连接类型
    启动子线程
      读取数据
        心跳包 - 忽略
        截图数据 - 保存到本地，通知UI线程
        从代码队列取数据
    设置截图获取回调
    开启UI循环
      用户点击粘贴代码 - 加入代码队列
    ```
- 客户端 worker
  - 流程
    ```
    建立连接
    注册连接类型
    注册键盘事件回调 - 截图并添加到截图队列
    启动事件循环
      读取数据
        心跳包 - 忽略
        代码数据 - 添加到剪贴板，声音通知
    ```

##### 数据格式
```
首部: 请求码(4) + 请求体长度(4) + 保留字段(4)
请求体: 数据
```

**请求码类型**:

1. 心跳数据 100，长度 0
2. worker注册 101，长度 0
3. helper注册 102，长度 0
4. 截图数据 201
5. 代码数据 202


<!-- 
主要功能

- 服务端
  - 广播截图
  - 接收数据并添加到剪贴板
- 客户端
  - 发送数据
  - 接收截图数据，保存并打开

实现

- 服务端
  1. 注册热键回调
     1. 获取当前屏幕截图数据
     2. 通知子进程发送数据
  2. 监听网络请求
  3. 开启子进程建立连接 - 进程间通信
     1. 子线程1 - 发送数据任务
        1. 收到通知后发送截图数据
     2. 子线程2 - 读取数据任务
        1. 读取数据后将数据复制到剪贴板

- 客户端
  1. 建立连接
     1. 开启子线程读取 - 服务端广播数据，保存并打开
  2. 用户执行操作 - 将数据发送到服务端 -->
